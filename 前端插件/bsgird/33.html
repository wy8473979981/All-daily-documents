<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
	</head>
	<th w_edit="text" w_index="serNo" data-w_index="serNo">111序列号</th>
	<th w_edit="text" w_index="salesOrderId" data-w_index="salesOrderId">订单号</th>
	<th w_edit="text" w_index="prdCode" data-w_index="prdCode">产品代码</th>
	<th w_edit="text" w_index="prdName" data-w_index="prdName">产品名称</th>
	<th w_edit="text" w_index="model" data-w_index="model">规格型号 </th>
	<th w_edit="text" w_index="despatch_type" data-w_index="despatch_type">发运方式</th>
	<th w_edit="text" w_index="amt" data-w_index="amt">库存数量</th>
	<th w_edit="text" w_index="warehouseName" data-w_index="warehouseName">仓库名称</th>
	<th w_edit="text" w_index="positionName" data-w_index="positionName">货位名称</th>
	<th w_edit="text" w_index="bat" data-w_index="bat">批次</th>
	gridObj.options.settings.localData = [{serNo: '', salesOrderId:'', prdCode:'', prdName:'', model:'', despatch_type:'', amt:'', warehouseName:'', positionName:'', bat:''}];

	<body>
		
		<form action="/dywms/private/promanage/Pur_Pro/purlist" method="post">
			<input id="unitid" name="unitid" value="" type="hidden">
			<table id="ShowSelectedData" class="bsgrid table" style="min-width: 666px;">
				<thead>
					<tr>
						<th w_edit="text" w_index="serial_number" data-w_index="serial_number">111序列号</th>
						<th w_edit="text" w_index="picking_number" data-w_index="picking_number">拣货单号</th>
						<th w_edit="text" w_index="product_code" data-w_index="product_code">产品代码</th>
						<th w_edit="text" w_index="product_name" data-w_index="product_name">产品名称</th>
						<th w_edit="text" w_index="specification_model" data-w_index="specification_model">规格型号 </th>
						<th w_edit="text" w_index="number" data-w_index="number">数量</th>
						<th w_edit="text" w_index="company" data-w_index="company">主计量单位</th>
						<th w_edit="text" w_index="warehouse_name" data-w_index="warehouse_name">仓库名称</th>
					</tr>
				</thead>
				<tbody>

					<tr>
						<td colspan="9" class="lineNoWrap">没有数据可以用于显示。</td>
					</tr>
				</tbody>
				<tfoot>
					<tr>
						<td class="aggLabel">当前页总数:</td>
						<td w_agg="count" class="aggValue"></td>
						<td class="aggLabel">
							<!-- Count(XH*ID) -->当前总量:</td>
						<td w_agg="custom,countXhMultId" class="aggValue"></td>
						<td class="aggValue"></td>
						<!--<td class="aggLabel">Max(price):最高无税单价</td>
						<td w_agg="max,price" class="aggValue"></td>
						<td class="aggLabel" w_hidden="true">Sum(taxcount):含税总计</td>
						<td w_agg="sum,taxcount" class="aggValue"></td>-->
					</tr>
				</tfoot>
			</table>

			<table id="ShowSelectedData_pt_outTab" class="bsgridPagingOutTab" style="display: none; min-width: 666px; width: 980px;">
				<tbody>
					<tr>
						<td align="right" id="ShowSelectedData_pt">
							<table class="bsgridPaging noPageSizeSelect">
								<tbody>
									<tr>
										<td>当前显示:&nbsp;<span id="ShowSelectedData_pt_startRow"></span>&nbsp;-&nbsp;<span id="ShowSelectedData_pt_endRow"></span></td>
										<td>共:&nbsp;<span id="ShowSelectedData_pt_totalRows"></span></td>
										<td><input class="pagingBtn firstPage" type="button" id="ShowSelectedData_pt_firstPage" value="首&nbsp;页">&nbsp;<input class="pagingBtn prevPage" type="button" id="ShowSelectedData_pt_prevPage" value="上一页"></td>
										<td>
											<div><span id="ShowSelectedData_pt_curPage"></span>&nbsp;/&nbsp;<span id="ShowSelectedData_pt_totalPages"></span></div>
										</td>
										<td><input class="pagingBtn nextPage" type="button" id="ShowSelectedData_pt_nextPage" value="下一页">&nbsp;<input class="pagingBtn lastPage" type="button" id="ShowSelectedData_pt_lastPage" value="末&nbsp;页"></td>
										<td class="gotoPageInputTd"><input class="gotoPageInput" type="text" id="ShowSelectedData_pt_gotoPageInput"></td>
										<td class="gotoPageButtonTd"><input class="pagingBtn gotoPage" type="button" id="ShowSelectedData_pt_gotoPage" value="跳&nbsp;转"></td>
										<td class="refreshPageTd"><input class="pagingBtn refreshPage" type="button" id="ShowSelectedData_pt_refreshPage" value="刷&nbsp;新"></td>
									</tr>
								</tbody>
							</table>
						</td>
					</tr>
				</tbody>
			</table>
		</form>
	</body>

	<script type="text/javascript">
		$.fn.bsgrid.defaults.extend.addNewEditRow = function(options) {
			debugger;
			gridObj.options.settings.localData = [{
				serial_number: '',
				picking_number: '',
				product_code: '',
				product_name: '',
				specification_model: '',
				number: '',
				company: '',
				warehouse_name: ''
			}];
			var gridObj = $.fn.bsgrid.getGridObj(options.gridId);
			//add new edit Row when no datum
			var header = $.fn.bsgrid.getGridHeaderObject(options);
			var rowSb = "";
			if (options.settings.pageSize > 0) {
				var columnsModel = options.columnsModel;
				var trSb = new StringBuilder();
				trSb.append("<tr>");
				for (var hi = 0; hi < header.length; hi++) {
					trSb.append('<td style="text-align: ' + columnsModel[hi].align + ";");
					if (columnsModel[hi].hidden == "true") {
						header.eq(hi).css("display", "none");
						trSb.append(" display: none;")
					}
					trSb.append('"');
					trSb.append(">&nbsp;</td>")
				}
				trSb.append("</tr>");
				rowSb = trSb.toString()
			};
			if ($.isEmptyObject(gridObj.options.settings.localData[0])) {
				gridObj.options.settings.localData = [{
					procode: '',
					proname: '',
					unit: '',
					count: '',
					prices: '',
					price: '',
					taxprice: '',
					taxcount: ''
				}];
				gridObj.refreshPage()
					//$("#" + options.gridId + " tbody").prepend(rowSb);
			} else {
				$("#" + options.gridId + " tbody").prepend(gridObj.getRow(0).clone(true));
				//$('#'+ options.gridId + ' thead th').each(function(colIndex) {
				gridObj.getRowCells(0).each(function(colIndex) {
					//debugger;
					var columnModel = options.columnsModel[colIndex];
					if (columnModel.render != "") {
						var render_method = eval(columnModel.render);
						var render_html = render_method(null, 0, colIndex, options);
						$(this).html(render_html)
					} else {
						if (columnModel.edit != "textarea") {
							$(this).children().val("")
						} else {
							$(this).children().text("")
						}
					}
					$(this).html($(this).children().removeClass("bsgrid_editgrid_change").clone(true))
						.removeAttr("title");
				});
			}
			gridObj.getRow(0).data("record", null).data("new", "true");
			//新行时，增加class 表明是新行。
			var firstCell = '<input class="bsgrid_editgrid_edit newLine" type="text" value="">';
			$(gridObj.getRowCells(0)[0]).html(firstCell);
			console.log('select new row');
			gridObj.selectRow(0);
			//$(gridObj.getRowCells(0)[0]).append('<span class="ti-menu" data-toggle="modal" data-target="#dialogSelectPro" style="right:0;position: absolute;padding: 5px;margin-right: 6px;"></span>');
		};
	</script>
	<script type="text/javascript">
		$.fn.bsgrid.defaults.extend.addNewEditRow = function(options) {
			debugger;
			gridObj.options.settings.localData = [{
				serial_number: '',
				picking_number: '',
				product_code: '',
				product_name: '',
				specification_model: '',
				number: '',
				company: '',
				warehouse_name: ''
			}];
			gridObj = $.fn.bsgrid.getGridObj(options.gridId);
			//add new edit Row when no datum
			var header = $.fn.bsgrid.getGridHeaderObject(options);
			var rowSb = "";
			if (options.settings.pageSize > 0) {
				var columnsModel = options.columnsModel;
				var trSb = new StringBuilder();
				trSb.append("<tr>");
				for (var hi = 0; hi < header.length; hi++) {
					trSb.append('<td style="text-align: ' + columnsModel[hi].align + ";");
					if (columnsModel[hi].hidden == "true") {
						header.eq(hi).css("display", "none");
						trSb.append(" display: none;")
					}
					trSb.append('"');
					trSb.append(">&nbsp;</td>")
				}
				trSb.append("</tr>");
				rowSb = trSb.toString()
			};
			if ($.isEmptyObject(gridObj.options.settings.localData[0])) {
				gridObj.options.settings.localData = [{
					serial_number: '',
					picking_number: '',
					product_code: '',
					product_name: '',
					specification_model: '',
					number: '',
					company: '',
					warehouse_name: ''
				}];
				gridObj.refreshPage()
					//$("#" + options.gridId + " tbody").prepend(rowSb);
			} else {
				$("#" + options.gridId + " tbody").prepend(gridObj.getRow(0).clone(true));
				//$('#'+ options.gridId + ' thead th').each(function(colIndex) {
				gridObj.getRowCells(0).each(function(colIndex) {
					//debugger;
					var columnModel = options.columnsModel[colIndex];
					if (columnModel.render != "") {
						var render_method = eval(columnModel.render);
						var render_html = render_method(null, 0, colIndex, options);
						$(this).html(render_html)
					} else {
						if (columnModel.edit != "textarea") {
							$(this).children().val("")
						} else {
							$(this).children().text("")
						}
					}
					$(this).html($(this).children().removeClass("bsgrid_editgrid_change").clone(true))
						.removeAttr("title");
				});
			}
			gridObj.getRow(0).data("record", null).data("new", "true");
			//新行时，增加class 表明是新行。
			var firstCell = '<input class="bsgrid_editgrid_edit newLine" type="text" value="">';
			$(gridObj.getRowCells(0)[0]).html(firstCell);
			console.log('select new row');
			gridObj.selectRow(0);
			//$(gridObj.getRowCells(0)[0]).append('<span class="ti-menu" data-toggle="modal" data-target="#dialogSelectPro" style="right:0;position: absolute;padding: 5px;margin-right: 6px;"></span>');
		};
		$(function() {
			$.fn.bsgrid.defaults.displayBlankRows = false;
			gridObj = $.fn.bsgrid.init('ShowSelectedData', { /* 初始化 */
				autoLoad: false,
				localData: [{}],
				pageSize: 5,
				event: {
					customCellEvents: {
						click: function(record, rowIndex, colIndex, tdObj, trObj, options) {
							if (colIndex == 0 && gridObj.getSelectedRow().length > 0) {
								// $(gridObj.getRowCells(0)[0]).find('.bsgrid_editgrid_edit')
								if (gridObj.getSelectedRow().find('.bsgrid_editgrid_edit').hasClass('newLine')) {
									$(gridObj.getRowCells(0)[0]).append('<span class="fa fa-plus-square fa-1" data-toggle="modal" id="proSelector" data-target="#proSelectorModal" style="right:0;position: absolute;padding: 5px;margin-right: 6px;"></span>')
								} else {
									$(tdObj).append('<span class="ti-menu" data-toggle="modal" data-target="#proSelectorModal" style="right:0;position: absolute;padding: 5px;margin-right: 6px;"></span>');
								}
							}
						}
					},
					extend: {
						settings: {
							supportGridEdit: true, // default false, if support extend grid edit
							supportGridEditTriggerEvent: 'rowClick', // default 'rowClick', values: ''(means no need Trigger), 'rowClick', 'rowDoubleClick', 'cellClick', 'cellDoubleClick'
						}
					}
				}
			});
			gridObj.options.settings.localData = [{}];
		});

		function countXhMultId(gridObj, options) {
			var count = 0;
			for (var i = 0; i < options.curPageRowsNum; i++) {
				var id = gridObj.getColumnValue(i, 'count');
				count += parseInt(id);
			}
			return count;
		};

		function operate(record, rowIndex, colIndex, options, options) {
			return '<a href="#" onclick="doDelete(' + rowIndex + ');">删除</a>';
		};

		function doEdit(rowIndex) {
			var id = gridObj.options.settings.localData[rowIndex].id;
			$.post("${base}/private/promanage/purorder/updatepro/" + id, {}, function(data) {
				$("#pur_proId").val(data.id);
				$('#' + data.id).attr("selected", "selected");
				proCodeSelectors[0].selectize.setValue([data.proId]);
				$("#pur_procount").val(data.count);
				$("#pur_protaxprice").val(data.taxprice);
				$("#pur_proprice").val(data.price);
				$("#pur_protaxcount").val(data.taxcount);
				$("#pur_prodiscount").val(data.discount);
				$("#pur_prorates").val(data.rates);
				$("#pur_pronote").val(data.note);
			}, "json")
		};

		function doDelete(rowIndex) {
			console.log('RowIndex', rowIndex);
			var curIndex = gridObj.options.settings.pageSize * (gridObj.getCurPage() - 1) + rowIndex;
			gridObj.options.settings.localData.splice(curIndex, 1);
			gridObj.refreshPage();
			console.log('data', gridObj.options.settings.localData);
		};
	</script>

</html>